---
# Install application if not already installed
- name: Is wdk installed?
  win_stat:
    path: "C:\\Program Files (x86)\\Windows Kits\\8.1\\Debuggers\\x64\\symstore.exe"
  register: app

- name: Copy cached file to download area
  raw: "xcopy /y /e {{ cache_location }}\\wdk {{ download_location }}\\wdk\\"
  when: not app.stat.exists

- name: Install wdk
  raw: "{{ download_location }}\\wdk\\{{ file }} /norestart /q /ceip off"
  when: not app.stat.exists

- name: Delete local file
  win_file:
    path: "{{ download_location }}\\wdk\\"
    state: absent
